import random


def credit_card_maker():

    def account_management():
        account_list = {}

        def card_creation():
            def luhn_algorithm(card_number):
                total = 0
                for i, n in enumerate(reversed(card_number)):
                    d = int(n)
                    if i % 2 == 0:
                        d *= 2
                        if d > 9:
                            d -= 9
                    total += d
                return (10 - total % 10) % 10

            def number_creation():
                while True:
                    bank_identifier = "400000"
                    current_customer = "".join(str(random.randrange(10)) for _ in range(9))
                    card_test_number = bank_identifier + current_customer
                    if card_test_number not in account_list:
                        return card_test_number

            def pin_creation():
                return "".join(str(random.randrange(10)) for _ in range(4))

            card = number_creation()
            checksum = luhn_algorithm(card)
            final_card_number = card + str(checksum)
            pin = pin_creation()

            account_list[final_card_number] = pin

            print("Your account has been created:")
            print("Your card number:")
            print(final_card_number)
            print("Your card PIN:")
            print(pin)

        def account_login():
            menu = {
                "1": "1. Balance",
                "2": "2. Log out",
                "0": "0. Exit"
            }

            login_input = input("Enter your card number: ")
            pin_input = input("Enter your PIN: ")

            if login_input in account_list and account_list[login_input] == pin_input:
                print("You have successfully logged in!")
                while True:
                    for option in menu.values():
                        print(option)

                    loged_choice = input()

                    if loged_choice == "1":
                        print("Balance: 0")
                    elif loged_choice == "2":
                        return
                    elif loged_choice == "0":
                        print("Bye!")
                        return "exit"
            else:
                print("Wrong card number or PIN!")

        def menu():
            while True:
                menu = {
                    "1": "1. Create an account",
                    "2": "2. Log into account",
                    "0": "0. Exit"
                }

                for option in menu.values():
                    print(option)

                user_choice = input()

                if user_choice == "1":
                    card_creation()
                elif user_choice == "2":
                    result = account_login()
                    if result == "exit":
                        return
                elif user_choice == "0":
                    print("Bye!")
                    return

        menu()

    account_management()


credit_card_maker()







